<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>Recapture That Power of Setu | Alternative Sky</title>
    <meta name="description" content="\.">
    <meta name="keywords" content>
    <meta name="HandheldFriendly" content="True">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" href="https://p.sda1.dev/1/31a2170cd16f0fb7ab2e50b2e39bf9a1/avatar.jpg"> <link rel="alternate" href="/atom.xml" title="Alternative Sky">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="这件事儿还挺有意思的（挠头），水一篇博客。  不是一篇技术博文，这是为了爱和正义与网络安全进行的斗争">
<meta property="og:type" content="article">
<meta property="og:title" content="Recapture That Power of Setu">
<meta property="og:url" content="http://kr2.moe/2021/02/04/ghs/index.html">
<meta property="og:site_name" content="Alternative Sky">
<meta property="og:description" content="这件事儿还挺有意思的（挠头），水一篇博客。  不是一篇技术博文，这是为了爱和正义与网络安全进行的斗争">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-08-16T09:24:24.778Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Recapture That Power of Setu">
<meta name="twitter:description" content="这件事儿还挺有意思的（挠头），水一篇博客。  不是一篇技术博文，这是为了爱和正义与网络安全进行的斗争">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
    <link href="//cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css"> 

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById("loading-bar").style.width = num + "%";
      }
    </script>

    <script>
      window.MathJax = {
        // mathjax config
        loader: { load: ["[tex]/ams"] },
        tex: {
          packages: { "[+]": ["ams"] },
          inlineMath: [["$", "$"]],
          displayMath: [["$$", "$$"]],
          processEscapes: true,
          digits: /^(?:[0-9]+(?:\{,\}[0-9]{3})*(?:\.[0-9]*)?|\.[0-9]+)/,
          maxBuffer: 5 * 1024,
        },
        options: {
          skipHtmlTags: [
            "script",
            "noscript",
            "style",
            "textarea",
            "pre",
            "code",
            "annotation",
            "annotation-xml",
          ],
          includeHtmlTags: {
            br: "\n",
            wbr: "",
            "#comment": "",
          },
          compileError: function (doc, math, err) {
            doc.compileError(math, err);
          },
          typesetError: function (doc, math, err) {
            doc.typesetError(math, err);
          },
        },
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/styles/atom-one-dark.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/highlight.min.js"></script>

    <script>
      hljs.configure({
        tabReplace: "    ",
      });
      hljs.highlightAll();
      // hljs.initHighlightingOnLoad();
    </script>

    <script src="//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script>
  <link rel="alternate" href="/atom.xml" title="Alternative Sky" type="application/atom+xml">
</head>
</html>

<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
	<div class="wrapper container">
		<a class="logo flat-box" href='/'>
			Alternative Sky
		</a>
		<div class='menu'>
			<ul class='h-list'>
				
				<li>
					<a class='flat-box nav-home' href='/'>
						Home
					</a>
				</li>
				
				<li>
					<a class='flat-box nav-archives' href='/archives'>
						Archives
					</a>
				</li>
				
				<li>
					<a class='flat-box nav-about' href='/about'>
						About
					</a>
				</li>
				
			</ul>
			<div class='underline'></div>
		</div>
		
		<div class="m_search">
			<form name="searchform" class="form u-search-form">
				<input type="text" class="input u-search-input" placeholder="Search" />
				<span class="icon icon-search"></span>
			</form>
		</div>
		
		<ul class='switcher h-list'>
			
			<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search"></span></a></li>
			
			<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu"></span></a></li>
		</ul>
	</div>
	<aside class="menu-phone">
		<nav>
			
			<a href="/" class="nav-home nav">
				Home
			</a>
			
			<a href="/archives" class="nav-archives nav">
				Archives
			</a>
			
			<a href="/about" class="nav-about nav">
				About
			</a>
			
		</nav>
	</aside>
</header>
    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container'>
      <div class='l_main'>
        <article id="post-ghs" class="post white-box article-type-post" itemscope
	itemprop="blogPost">
	<section class='meta'>
		<h2 class="title">
			<a href="/2021/02/04/ghs/">
				Recapture That Power of Setu
			</a>
		</h2>

		

		

		<time>
			2月 4, 2021
		</time>

		<span class="vertical-line" style="color: #b5b5b5; margin: 0px 5px 0px 5px;">|</span>

		<span id="/2021/02/04/ghs/" class="leancloud_visitors" data-flag-title="文章阅读量统计">
			<em class="post-meta-item-text"> 阅读量 </em>
			<i class="leancloud-visitors-count">0</i>
		</span>

		<span class="vertical-line" style="color: #b5b5b5; margin: 0px 5px 0px 5px;">|</span>

		<span class="words-count">
			总字数 2.3k
		</span>

		<span class="vertical-line" style="color: #b5b5b5; margin: 0px 5px 0px 5px;">|</span>

		<span class="time-count">
			期望阅读时间 9 min
		</span>
	</section>
	
	<section class="tog"></section>
	
	<section class="article typo">
		<div class="article-entry" itemprop="articleBody">
			<p>这件事儿还挺有意思的（挠头），水一篇博客。</p>
<blockquote>
<p>不是一篇技术博文，这是为了爱和正义与网络安全进行的斗争</p>
</blockquote>
<a id="more"></a>

<hr>
<p>因为不知道什么原因，2021/2/3 日，我终于发现是因为一些神秘的问题，进而导致无法自定义 header 的 eagle extension 无法方便地从 pixiv 上下载色图！</p>
<p>盗链这部分就使用 firefox 测试了，比较简单。</p>
<p>这本应该是一个容易解决的问题。我只是想下色图，而下色图只需要在 <code>referer</code> 中添加 <code>https://www.pixiv.net</code> 即可。但是这件事儿落到 eagle extension 上就变复杂了，因为涉及阅读的 eagle extension 源码的问题，还涉及浏览器安全的问题。</p>
<p>首先进到 edge 的插件目录里，找到 eagle 的插件，复制出去，然后进行修改。通过开发者模式进行导入。</p>
<p>观察到下载图片的核心函数，<code>background.js</code> 的 <code>line: 480</code>(and 380，注意有两处，分别对应拖拽和右键菜单) 左右出现了获取图片 base64 等操作。</p>
<pre><code class="javascript">ensureEagleIsOpen(function () {
  msg.src = convertSrc(msg.src);
  if (!msg.src) return;
  // console.time(&quot;取得图片 base64&quot;);
  toDataURL(msg.src, function(base64) {
    // console.timeEnd(&quot;取得图片 base64&quot;);
    var result = base64 || msg.src;
    var data = {
...</code></pre>
<blockquote>
<p>不得不吐槽一句 <code>toDataURL</code> 的可读性简直了，还把 <code>custom</code> 拼错了</p>
</blockquote>
<p>其一部分代码是这样的</p>
<pre><code class="javascript">xhr.onload = function() {
  clearTimeout(timeout);
  var reader = new FileReader();
  reader.onloadend = function() {
    if (!sent) {
      sent = true;
      if (reader.result.indexOf(&quot;data:image&quot;) &gt; -1) {
        callback(reader.result);
      } else {
        callback(undefined);
      }}}
  reader.readAsDataURL(xhr.response);
};

...

timeout = setTimeout(function () {
  if (!sent) {
    sent = true;
    xhr.abort();
    callback(undefined);
  }
}, timeout);</code></pre>
<ol>
<li><blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequestEventTarget/onload" target="_blank" rel="noopener"><code>XMLHttpRequest.onload</code></a>  <code>callback</code> is the function to be executed when the request completes successfully.”</p>
</blockquote>
</li>
<li><blockquote>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader/onload" target="_blank" rel="noopener"><code>FileReader.onload</code></a> property contains an event handler executed when the <code>load</code> event is fired.</p>
</blockquote>
</li>
</ol>
<p>总而言之，这段代码通过 <code>toDataURL</code> 来尝试获取对应图片的 base64，若失败，将 URL 再传给主程序处理，而主程序端若接受到 URL，则通过代理再次尝试获取该图片。现在的情况是，两次都失败了，因为两次都没有，也不可能设置 <code>referer</code>。</p>
<p>尝试使用服务端的方法，观察到 eagle 有两套 API，一套是官方最近公布的<a href="https://www.yuque.com/augus-gsjgn/eagle-api" target="_blank" rel="noopener">Open API</a>，还有一套是原本用于 extension 和主程序通信的 API，端口号分别为 <code>41593</code> 与 <code>41595</code>。由于无法获取原 API 的信息，只能使用开放的 API。</p>
<p>尝试通过官方文档中的模板测试 eagle 服务端是否能进行下载，结论是不行，eagle 的进度条会卡住最后下载失败。</p>
<pre><code class="javascript">var data = {
  &quot;url&quot;: &quot;https://i.pximg.net/img-original/img/2021/02/02/19/18/33/87484491_p0.jpg&quot;,
  &quot;name&quot;: &quot;Test&quot;,
  &quot;headers&quot;: {
    &quot;referer&quot;: &quot;https://www.pixiv.net&quot;
  }
};

var requestOptions = {
  method: &#39;POST&#39;,
  body: JSON.stringify(data),
  redirect: &#39;follow&#39;
};

fetch(&quot;http://localhost:41595/api/item/addFromURL&quot;, requestOptions)
  .then(response =&gt; response.json())
  .then(result =&gt; console.log(result))
  .catch(error =&gt; console.log(&#39;error&#39;, error));</code></pre>
<p>我使用其他的链接试了试，似乎 eagle 本身在 Open API 这部分的实现有部分问题，最明显的表现是 <code>添加文件 (0/0)</code>…</p>
<p>求求你赶紧把这部分的功能做好吧，我只能自己实现了orz</p>
<p>虽然不知道为什么，不过现在剩下的解法只有通过传递 base64 的方式来下载图片。<code>jQuery</code> 为了安全问题禁止更改 header 中的 <code>referer</code>，于是只能通过服务端的 <code>request</code> 来运行。</p>
<hr>
<p>这里又因为经验吃亏了，我也测试了通过 <code>fetch</code> 来包含 header 信息，依然不行。通过抓包显示 <code>fetch</code> 根本没有添加上 <code>referer</code> 参数，似乎也是因为 ajax 不允许修改 <code>referer</code> 的问题。</p>
<p>再换方法，根据 <a href="https://stackoverflow.com/questions/53627310/using-fetch-in-chrome-extension-doesnt-include-referer-header-in-the-request" target="_blank" rel="noopener"><code>stackoverflow</code> 上的办法</a>，可以通过给插件提供 <code>webRequestBlocking</code> 权限来发送修改 <code>referer</code> 参数。</p>
<p>好家伙，依然不行。</p>
<pre><code class="javascript">chrome.webRequest.onBeforeSendHeaders.addListener(
  function(details) {
    details.requestHeaders.push({name: &#39;Referer&#39;, value: &#39;https://www.pixiv.net&#39;});
    return {requestHeaders: details.requestHeaders};
  },
  {urls: [&quot;http://i.pximg.net/*&quot;]},
  [&quot;blocking&quot;, &quot;requestHeaders&quot;]
);


fetch(&#39;http://i.pximg.net/img-original/img/2021/02/02/19/18/33/87484491_p0.jpg&#39;)</code></pre>
<p>现在想来，应该就是跨域访问的问题，浏览器阻拦 referer 天经地义，只有我是傻逼和网络安全斗智斗勇。</p>
<hr>
<p>除此之外，我还考虑了绕开 referer 的办法，即使用（及其古老的）referer killer 的思路，可惜在 2021 年早已行不通。</p>
<p>那么，不考虑和浏览器斗智斗勇，现在的解决办法有几个</p>
<ul>
<li>搭建“反代”来绕过无法发送带 referer 请求的问题</li>
<li>写油猴脚本，通过油猴脚本来发送带 referer 的请求，已证明可行，但是工程量不小，我有点懒</li>
<li>还有一个，通过 inject code 来让浏览器自己发 referer（后续验证不太可行）</li>
</ul>
<hr>
<p>一觉睡了起来，脑子清醒了很多，重新找问题。</p>
<p>查一查 log，发现 eagle 2.0.0 版本更新是在 2021/1/21，而我最后一张图是在 2021/1/21 晚存的。再次查 log 发现，之前的内容都是通过 base64（见后） 下载的</p>
<pre><code>[extension] version: 2.1.8 - Save image: [base64][2090658], source: https://www.pixiv.net/artworks/87159236</code></pre><p>所以有两种可能性，eagle 插件更新，edge 更新和 pixiv 外链政策更新导致的问题。</p>
<p>去查 qq 聊天记录，看到 edge  88 更新是在 2021/2/22 日（当时我去吐槽了好好看），现在唯一需要的是一个老版本的 eagle extension 插件。发现 extension 更新是 1.12 日，更不可能了。在之前发送请求的时候，edge 可能会回以缓存，现在的机制变化了。</p>
<p>但是换回老版本的 edge 不太可行，这段思考只能帮助我坚定地确定了，和浏览器斗智斗勇是不可能的，最优雅的解决办法是通过 inject code。那，终于到了写代码的时候了。</p>
<hr>
<blockquote>
<p>敢情我昨天一晚上白忙了啊… 不过也算学了不少东西</p>
</blockquote>
<p>草，结果是，inject code 也没能解决问题，依然因为 CORS 限制。目前已知油猴脚本可以突破 CORS 的限制，但是完全不知道是怎么做到的。</p>
<p>通过在原脚本中添加</p>
<pre><code class="javascript">console.log(msg.src);
chrome.tabs.executeScript(
  tab.id,
  { code: `window.inject_url = &quot;${msg.src}&quot;;` },
  () =&gt; {
    chrome.tabs.executeScript(
      tab.id, 
      { file: &quot;pixiv.js&quot; }, 
      (res) =&gt; {
        console.log(&quot;Exec: &quot; + res);
      });
  }
);</code></pre>
<p>可以实现简单的跨域传递参数和返回参数，</p>
<p>脚本中的对应函数如下</p>
<pre><code class="javascript">(function () {
  console.log(&quot;Downloading&quot;: window.inject_url);    
  var ret;
  function getPixivImage(url) {
    var xhr = new XMLHttpRequest();
    var timeout = 700;
    var sent = false;
    // From background.js
    xhr.onload = function () {
      clearTimeout(timeout);
      var reader = new FileReader();
      reader.onloadend = function () {
        if (!sent) {
          sent = true;
          if (reader.result.indexOf(&quot;data:image&quot;) &gt; -1) {
            ret = reader.result;
          } else {
            ret = undefined;
          }
        }
      };
      reader.readAsDataURL(xhr.response);
    };
    xhr.open(&quot;GET&quot;, url);
    xhr.responseType = &quot;blob&quot;;
    xhr.send();

    timeout = setTimeout(function () {
      if (!sent) {
        sent = true;
        xhr.abort();
        ret = undefined;
      }
    }, timeout);
  }
  getPixivImage(window.inject_url);

  return ret;
})();</code></pre>
<p>为了防止 CSRF，这里会不工作也情有可原… 又是一个没有想到的地方。那，估计只能调用油猴脚本了，这操作越来越复杂了。</p>
<p>油猴脚本的 <code>GM_xmlhttpRequest</code> 可以实现跨域访问，但是还不太清楚其原理。</p>
<p>但是从外部访问油猴脚本看起来就不太可能… 最终办法真的只有用油猴和 eagle extension 配合了吗？</p>
<ul>
<li>使用油猴脚本进行跨域访问，将结果写入全局变量中（使用 messaging 也行）</li>
<li>通过<code>pixiv.js</code> 获取全局变量和油猴脚本对接，实现简单的跨域访问。</li>
</ul>
<p>这里还需要了解 CORS 的简单请求有关内容。满足一系列条件（懒得ref）的请求为简单请求，而简单请求是先发送信息再检查。但是这回的 GET 中含有 referer，所以依然无法满足简单请求的条件。</p>
<p><a href="https://www.chromium.org/Home/chromium-security/extension-content-script-fetches" target="_blank" rel="noopener">这篇文档</a>里描述了 content scripts 在 chromium 88 里已无法跨域。</p>
<hr>
<p>我开了 bgm 上的<a href="https://bgm.tv/group/topic/361172" target="_blank" rel="noopener">讨论</a>。</p>
<hr>
<p>好家伙了，我直接好家伙，最后的解决方式有两个</p>
<p>第一个是，在 bgm 的讨论里有人提到给 eagle 发了 email 请求更改这部分的逻辑，然后… 然后更新版本后问题就解决了。</p>
<p>第二个是添加反代（没想到基于 cloudflare worker 的反代那么简单？！），既然问题已经解决了就不做了。</p>
<p>eagle 新版本的逻辑也很奇怪，会先将文件下载到一个 temp 目录里再让主程序从这个目录 fetch 图片。但是这就导致了一个问题：无法 retry。这是个很简单的问题，只要修改一下 retry 的逻辑就好了，但是 eagle 团队就是没有做好…</p>
<p>而且，什么时候能把设置代理给加回来… 我服气啦</p>
<p>有很多很幼稚的地方和问题，这就当成变强过程中的一篇幼稚的博文吧。</p>
<p>不过在写这篇博文里我有这样的感受，以前学的看似“无用”的东西总会有用武之地。哪怕是我已经放弃了的 CTF 也提供给了不少解决问题的能力。感谢自己写过的每一行代码，感谢自己学过的每一个奇奇怪怪的知识。</p>

		</div>
		
	</section>
	
</article>

<!-- comments config -->
<br>
<div id="vcomments" class="post white-box article-type-post"></div>
<br>
<script>
	new Valine({
		el: '#vcomments',
		appId: '0P1DwbIiwq7XB7nsT9teGpNs-MdYXbMMI',
		appKey: 'uEuSv3RSeUF1uR0spxgvezR2',
		placeholder: 'QwQ.',
		notify: true,
		verify: true,
		avatar: 'mp',
		visitor: true
	})
</script>
      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<img class='avatar waves-image' src='https://p.sda1.dev/1/31a2170cd16f0fb7ab2e50b2e39bf9a1/avatar.jpg' />

<div class='header'>Traceback</div>
<div class='content'>
<div></div>
</div>
</section>

  <section class='m_widget friendly-links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="https://lirewriter.cn">
            <div class='name'>LittleRewriter</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://mgt.moe">
            <div class='name'>Margatroid</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://7li.moe">
            <div class='name'>HigHwind</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://q234rty.top">
            <div class='name'>Q234rty</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://vixbob.moe">
            <div class='name'>ViXbob</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/CS/"><div class='name'>CS</div><div class='badget'>2</div></a></li>
    
        <li><a class="flat-box" href="/categories/Daily/"><div class='name'>Daily</div><div class='badget'>5</div></a></li>
    
        <li><a class="flat-box" href="/categories/Design/"><div class='name'>Design</div><div class='badget'>3</div></a></li>
    
        <li><a class="flat-box" href="/categories/Math/"><div class='name'>Math</div><div class='badget'>2</div></a></li>
    
    </ul>
    
</div>
</section>

  
<div class="m_widget tagcloud">
    <div class="header">Tags</div>
    <div class='content'>
        <a href="/tags/Algorithms/" style="font-size: 14px; color: #808080">Algorithms</a> <a href="/tags/Atcoder/" style="font-size: 14px; color: #808080">Atcoder</a> <a href="/tags/Learning/" style="font-size: 17px; color: #404040">Learning</a> <a href="/tags/Memories/" style="font-size: 14px; color: #808080">Memories</a> <a href="/tags/杂记/" style="font-size: 14px; color: #808080">杂记</a> <a href="/tags/瞎写/" style="font-size: 20px; color: #000">瞎写</a>
    </div>
</div>



      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">
  <div class="social-wrapper">
     
    <a
      href="https://github.com/kririae"
      class="social github"
      target="_blank"
      rel="external"
    >
      <span class="icon icon-github"></span>
    </a>
    
    <a
      href="/atom.xml"
      class="social rss"
      target="_blank"
      rel="external"
    >
      <span class="icon icon-rss"></span>
    </a>
     
  </div>

  <div>
    Theme
    <a
      href="https://github.com/stkevintan/hexo-theme-material-flow"
      class="codename"
      >MaterialFlow</a
    >
    designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.
  </div>

  <div>Modified by <a href="https://kr2.moe">krr.</a></div>
</footer>

  <script>setLoadingBarProgress(80);</script>
  

<script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src='//cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js'></script>
<script src="//cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>

<script src="/js/jquery.fitvids.js"></script>
<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/" || "/";
  if (!ROOT.endsWith('/')) ROOT += '/';
  var BANNER_IMAGE = "true" == "true";
  var BANNER_HITOKOTO = "true" == "true";
  var BANNER_TITLE = "\." || "Alternative Sky";
  var BANNER_CUSTOMIMAGE = "true" == "true";
  var BANNER_IMAGELIST = "https://p.sda1.dev/1/b66fc4a626a011019bc8fe204188f93d/BG.jpg".split(',');
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>
  <script>setLoadingBarProgress(100);</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
